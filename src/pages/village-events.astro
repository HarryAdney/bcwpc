---
import ParishCouncilLayout from '../layouts/ParishCouncilLayout.astro'
import Hero from '../components/Hero.astro'
import { getCollection } from 'astro:content'

// Get all events from the collection
const allEvents = await getCollection('events')

// Get current date for filtering
const currentDate = new Date()
const currentDateString = currentDate.toISOString().split('T')[0]

// Filter for upcoming events only
const upcomingEvents = allEvents.filter(event => event.data.date >= currentDateString)

// Debug all events and their cost fields
console.log('All events with cost info:')
upcomingEvents.forEach(event => {
  console.log(`${event.data.title}: cost = ${JSON.stringify(event.data.cost)} (type: ${typeof event.data.cost}, truthy: ${!!event.data.cost})`)
})

// Sort events by date (earliest first)
const sortedEvents = upcomingEvents.sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())

// Function to format date for display
function formatDate(dateString) {
  const date = new Date(dateString)
  return date.toLocaleDateString('en-GB', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}
---

<ParishCouncilLayout title="Village Events">
  <Hero />
  <main class="container px-6 py-10 mx-auto">
    <div class="grid gap-6 md:grid-cols-3">
      <div class="md:col-span-2">
        <h1 class="text-xl font-bold">Village Events</h1>
<p class="mt-4">
      Stay up to date with upcoming events in West Burton. From Parish Council meetings to community celebrations,
      there's always something happening in our vibrant village community.
    </p>
    {sortedEvents.length === 0 ? (
      <div class="p-6 mt-8 rounded-lg bg-gray-50">
        <p>No upcoming events scheduled at the moment. Please check back soon!</p>
      </div>
    ) : (
      <div class="mt-8 space-y-6">
        {sortedEvents.map((event) => (
          <article class="p-6 transition-shadow bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md">
            <div class="flex flex-wrap items-start justify-between gap-4 mb-4">
              <div class="flex-1">
                <h2 class="mb-5 text-lg font-semibold text-gray-900">{event.data.title}</h2>
              </div>
            </div>

            <div class="grid gap-3 mb-4 text-sm text-gray-600 sm:grid-cols-2 lg:grid-cols-3">
              {event.data.date && event.data.date.toString().trim() && (
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <span>{formatDate(event.data.date)}</span>
                </div>
              )}

              {event.data.time && event.data.time.trim() && (
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span>{event.data.time}</span>
                </div>
              )}

              {event.data.location && event.data.location.trim() && (
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span>{event.data.location}</span>
                </div>
              )}
              {event.data.cost && (
                <div class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                    <text x="12" y="17" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold">Â£</text>
                  </svg>
                  <span>{event.data.cost}</span>
                </div>
              )}
            </div>

            <div class="mb-4 text-gray-700" set:html={event.data.description}></div>

            {event.data.contact && event.data.contact.trim() && (
              <div class="pt-4 border-t">
                <div class="mt-3 text-sm">
                  <span class="font-medium">Contact: <span class="mb-4" set:html={event.data.contact}></span></span>
                </div>
              </div>
            )}
          </article>
        ))}
      </div>
    )}

    <div class="mt-8">
      <h3 class="mb-4 text-lg font-semibold">Submit an Event</h3>
      <p class="mb-4 text-sm text-gray-600">
        Have an event to share with the community? <a href="mailto:clerk@burtoncumwalden-pc.gov.uk">Contact</a> the Parish Council to have it added to our events calendar.
      </p>
    </div>

      </div>


      <aside>
        <h2 class="text-xl font-bold text-left">Latest News</h2>
        <ul class="mt-4 space-y-2 text-blue-600">
          <li>
            Public Notices<a href="#" target="_blank" class="hover:underline"><br /></a
            >
          </li>
          <!-- <li><a href="#" class="hover:underline">Parish Meetings</a></li>
          <li><a href="#" class="hover:underline">Wallace Education Fund</a></li>
          <li><a href="#" class="hover:underline">Deliveries to West Burton</a></li>
          <li><a href="#" class="hover:underline">May Fair, 28th May 2020 has been canceled</a></li> -->
        </ul>
      </aside>
    </div>
  </main>


</ParishCouncilLayout>